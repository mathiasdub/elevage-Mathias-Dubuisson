{% extends "elevage/base.html" %}

{% block title %} {{ elevage.name }} {% endblock %}

{% block content %}

<fieldset>
    <legend><h1>Détail de l'élevage : {{ elevage.name }}</h1></legend>

    <ul>
    <li><strong>Argent :</strong> {{ elevage.argent }} €</li>
    <li><strong>Nourriture :</strong> {{ elevage.qt_nourriture }} kg</li>
    <li><strong>Nombre de cages :</strong> {{ elevage.nb_cages }}</li>
    <li><strong>Nombre de lapins :</strong> {{ nombre_lapins }}</li>
    </ul>

    <h3>Lapins actuels :</h3>
    <ul>
        {% for lapin in lapins %}
            {% if lapin.etat == "présent" or lapin.etat == "gravide" %}
                <li>{{ lapin }}</li>
            {% endif %}
        {% endfor %}
    </ul>
</fieldset>
    
<br><br>

    
<h1> Graphiques représentant l'élevage :</h1>

<h2>1. Population de l'élevage :</h2>
<canvas id="populationChart"></canvas>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
   fetch("/datas/{{ elevage.id }}/")
  .then(response => response.json())
  .then(data => {
    const labels = data.map(entry => `Tour ${entry.tour}`);
    const males = data.map(entry => entry.nb_males);
    const femelles = data.map(entry => entry.nb_femelles);
    const lapereaux = data.map(entry => entry.nb_lapereaux);

    new Chart(document.getElementById('populationChart'), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [
          { label: 'Mâles', data: males, borderColor: 'blue' },
          { label: 'Femelles', data: femelles, borderColor: 'pink' },
          { label: 'Lapereaux', data: lapereaux, borderColor: 'green' }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  });
</script>

    
<br><br>


<h1>Actions du tour :</h1>
    <form method="post">
        {% csrf_token %}
        <table>
            {{ form.as_table }}
        </table>
        <button type="submit">Valider le tour</button>
    </form>



    <br><br>
    <p><a href="{% url 'elevage:regles' %}" target="_blank">Voir la liste des règles</a></p>
    <p><a href="{% url 'elevage:liste' %}">Voir la liste des élevages</a></p>
    <p><a href="{% url 'elevage:supprimer' elevage.id %}">Supprimer cet élevage</a></p>

{% endblock %}